server {
    listen 80;  # 监听80端口
    server_name 115.190.116.72;  # 服务器域名或IP

    # 主目录配置
    root   /usr/share/nginx/html/;  # 网站根目录
    index  index.html index.htm;  # 默认索引文件

    # 全局日志配置
    access_log /var/log/nginx/access.log main;  # 访问日志路径和格式
    error_log /var/log/nginx/error.log warn;  # 错误日志路径和级别

    # 处理SPA路由，确保所有路径都重定向到index.html
    location / {  # 匹配所有请求
        try_files $uri $uri/ /index.html;  # 尝试查找文件，不存在则重定向到index.html
    }

    # 处理静态资源并设置缓存策略

    # CSS和JS文件 - 7天缓存
    location ~* \.(css|js)$ {  # 匹配CSS和JS文件
        try_files $uri $uri/ =404;  # 尝试查找文件，不存在返回404
        expires 7d;  # 设置过期时间为7天
        add_header Cache-Control "public, max-age=604800";  # 缓存控制头，公开缓存，最大存活时间604800秒(7天)
        add_header Vary Accept-Encoding;  # 告知缓存服务器根据Accept-Encoding请求头缓存不同版本
        access_log off;  # 不记录访问日志
    }

    # 图片、字体和媒体文件 - 30天缓存
    location ~* \.(png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|mp4|ogg|ogv|webm)$ {  # 匹配图片、字体和媒体文件
        try_files $uri $uri/ =404;  # 尝试查找文件，不存在返回404
        expires 30d;  # 设置过期时间为30天
        add_header Cache-Control "public, max-age=2592000";  # 缓存控制头，公开缓存，最大存活时间2592000秒(30天)
        add_header Vary Accept-Encoding;  # 告知缓存服务器根据Accept-Encoding请求头缓存不同版本
        access_log off;  # 不记录访问日志
    }

    # HTML文件 - 禁用缓存
    location ~* \.(html|htm)$ {  # 匹配HTML文件
        try_files $uri $uri/ =404;  # 尝试查找文件，不存在返回404
        expires -1;  # 立即过期
        add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate";  # 禁用缓存
    }

    # 开启gzip压缩
    gzip on;  # 启用gzip压缩
    gzip_vary on;  # 启用Vary: Accept-Encoding响应头
    gzip_proxied any;  # 对所有代理请求进行压缩
    gzip_comp_level 6;  # 压缩级别(1-9)，6为平衡压缩比和性能的选择
    gzip_buffers 16 8k;  # 压缩缓冲区大小
    gzip_http_version 1.1;  # 压缩所需的最低HTTP版本
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;  # 压缩的文件类型
    gzip_min_length 256;  # 最小压缩文件大小
    gzip_disable "MSIE [1-6]\.";  # 对IE1-6禁用压缩

    # 处理 favicon.ico
    location = /favicon.ico {  # 精确匹配favicon.ico
        log_not_found off;  # 不记录文件未找到的日志
        access_log off;  # 不记录访问日志
    }

    # 禁止访问隐藏文件和目录
    location ~ /\. {  # 匹配以.开头的文件或目录
        deny all;  # 拒绝所有访问
        access_log off;  # 不记录访问日志
        log_not_found off;  # 不记录文件未找到的日志
    }

    # 设置404错误页面
    error_page 404 /index.html;  # 将404错误重定向到index.html

    # 设置客户端最大body大小
    client_max_body_size 10m;  # 限制客户端请求体最大大小为10MB

    # 优化连接设置
    keepalive_timeout 65;  # 长连接超时时间65秒
    types_hash_max_size 2048;  # 增加类型哈希表大小，减少哈希冲突
    server_tokens off;  # 隐藏Nginx版本信息

    # 安全增强配置
    add_header X-Frame-Options SAMEORIGIN;  # 防止点击劫持，只允许同源iframe嵌入
    add_header X-XSS-Protection "1; mode=block";  # 启用XSS过滤，检测到攻击时阻止页面加载
    add_header X-Content-Type-Options nosniff;  # 防止MIME类型嗅探

    # 性能优化配置
    open_file_cache max=1000 inactive=20s;  # 缓存最多1000个文件描述符，20秒未访问移除
    open_file_cache_valid 30s;  # 30秒验证缓存有效性
    open_file_cache_min_uses 2;  # 文件至少被访问2次才缓存
    open_file_cache_errors on;  # 缓存文件访问错误

    # TCP优化
    tcp_nopush on;  # 启用NOPUSH，积累数据后再发送，提高带宽利用率
    tcp_nodelay on;  # 启用NODELAY，禁用Nagle算法，减少延迟
}